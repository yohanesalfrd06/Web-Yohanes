<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistem Monitoring TA - Yohanes Alfredo</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top shadow">
      <div class="container-fluid">
        <img src="assets/logo_untirta.png" alt="Logo UNTIRTA" class="logo_untirta" />
        <a class="navbar-brand" href="#">SISTEM MONITORING KEAMANAN KONTAINER BERBASIS IOT </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0" id="auth-nav-links" style="display: none">
            <li class="nav-item"><a class="nav-link" href="#profile" data-page="profile-section">Profil</a></li>
            <li class="nav-item"><a class="nav-link" href="#gallery" data-page="gallery-section">Galeri Kamera</a></li>
            <li class="nav-item"><a class="nav-link" href="#control" data-page="control-section">Control</a></li>
          </ul>

          <div class="d-flex align-items-center">
            <span class="navbar-text navbar-time"> <i class="fa-regular fa-clock"></i> <span id="current-time"></span> </span>
            <button class="btn btn-warning" id="auth-button" onclick="handleAuth()">Login</button>
          </div>
        </div>
      </div>
    </nav>

    <main class="container mt-5">
      <div id="login-section" class="card login-card content-section" style="display: block">
        <div class="login-card-header text-center">
          <img src="assets/logo_untirta.png" alt="Logo UNTIRTA" class="login-logo-large rounded-circle" />
          <h4 class="mt-2">Portal Admin TA S1</h4>
        </div>
        <div class="card-body p-4">
          <div class="mb-3">
            <label for="username" class="form-label">Username (UID)</label>
            <input type="text" class="form-control" id="username" placeholder="misal: yohannes_ta" />
          </div>
          <div class="mb-3">
            <label for="password" class="form-label">Password</label>
            <input type="password" class="form-control" id="password" placeholder="Password" />
          </div>
          <button class="btn btn-primary w-100 mb-3" onclick="login()">Login</button>
          <p class="text-danger text-center" id="auth-error"></p>

          <a href="#" class="text-center mt-2 d-block" data-bs-toggle="modal" data-bs-target="#changePasswordModal">Ganti Password?</a>
        </div>
      </div>

      <div id="profile-section" class="content-section">
        <div class="row justify-content-center">
          <div class="col-md-10">
            <div class="card info-card p-5 text-center">
              <img src="assets/foto_yohannes.png" class="profile-img mx-auto mb-4" alt="Foto Profil Yohannes Alfredo" />

              <h1 class="display-6 fw-bold mb-3">Yohanes Alfredo</h1>
              <h2 class="h5 text-muted mb-4">Mahasiswa S1 Teknik Elektro UNTIRTA</h2>

              <p class="deskripsi-project">
                Aplikasi sistem monitoring ini dibuat oleh <strong>Yohanes Alfredo</strong> untuk memenuhi Tugas Akhir Strata Satu (S1) di Jurusan Teknik Elektro, Universitas Sultan Ageng Tirtayasa (UNTIRTA). Sistem ini berfungsi untuk
                memantau perangkat IoT secara realtime melalui Firebase Realtime Database dan menampilkan data historis gambar. Penelitian dilakukan pada area kontainer di lingkungan Fakultas Teknik, UNTIRTA.
              </p>

              <hr />
              <p class="text-start"><i class="fa-solid fa-graduation-cap me-2 text-primary"></i> NIM: <strong>3332200045</strong></p>
              <p class="text-start"><i class="fa-solid fa-building-columns me-2 text-primary"></i> Jurusan: <strong>Teknik Elektro</strong></p>
              <hr />
              <p class="mb-1">Pembimbing 1: <strong>Prof. Dr. Alimuddin, S.T., M.M., M.T.</strong><br /></p>
              <p class="mb-0">Pembimbing 2: <strong>H. Alief Maulana, S.T., M.T</strong></p>
            </div>
          </div>
        </div>
      </div>

      <div id="gallery-section" class="content-section">
        <h2 class="mb-4 text-center">Galeri Riwayat Foto dari ESP32</h2>
        <p class="status text-center text-muted" id="gallery-status">Memuat data...</p>
        <div id="history-container"></div>
      </div>

      <div id="control-section" class="content-section">
        <h2 class="mb-4 text-center fw-bold text-primary">Panel Kontrol Perangkat IoT & Admin NFC</h2>
        <p class="text-center text-muted mb-5">Kontrol mode operasional perangkat secara realtime dan kelola data kartu akses pengguna.</p>

        <div class="row">
          <div class="col-lg-6">
            <div class="card control-card p-4">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="card-title mb-0"><i class="fa-solid fa-camera me-2 text-primary"></i> Mode Kamera</h5>
                <span id="camera-status-label" class="badge badge-status bg-secondary">Memuat...</span>
              </div>
              <hr />
              <div class="d-flex justify-content-between align-items-center">
                <label class="form-check-label me-3 fw-bold" for="cameraToggle">Mode Otomatis / Manual</label>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="cameraToggle" onclick="toggleCamera(this.checked)" />
                </div>
              </div>
              <small class="text-muted mt-2">Mode Otomatis (Hijau) mengirim perintah ON ke perangkat.</small>
            </div>

            <div class="card control-card p-4">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="card-title mb-0"><i class="fa-solid fa-door-closed me-2 text-success"></i> Status Kunci Pintu</h5>
                <span id="solenoid-status-label" class="badge badge-status bg-secondary">Memuat...</span>
              </div>
              <hr />
              <div class="d-flex justify-content-between align-items-center">
                <label class="form-check-label me-3 fw-bold" for="solenoidToggle">Kontrol Otomatis / Terkunci</label>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="solenoidToggle" onclick="toggleSolenoid(this.checked)" />
                </div>
              </div>
              <small class="text-muted mt-2">Kunci: Hijau=Terkunci (Aman). Merah=Terbuka (Akses Diberikan/Error).</small>
            </div>
          </div>

          <div class="col-lg-6">
            <div class="card control-card p-4 border-success">
              <h5 class="card-title mb-3 text-success"><i class="fa-solid fa-plus-circle me-2"></i> Tambah Kartu Akses Baru</h5>
              <p class="text-muted">Masukkan Nama dan UID kartu. UID harus sama persis dengan yang dibaca oleh ESP32.</p>
              <div class="mb-3">
                <label for="nfcName" class="form-label">Nama Pengguna</label>
                <input type="text" class="form-control" id="nfcName" placeholder="Contoh: Budi Santoso" />
              </div>
              <div class="mb-3">
                <label for="nfcUID" class="form-label">UID Kartu NFC</label>
                <input type="text" class="form-control" id="nfcUID" placeholder="Masukkan UID tanpa spasi/dash, misal: A1B2C3D4" />
              </div>
              <button class="btn btn-success w-100" onclick="addNFCCard()"><i class="fa-solid fa-floppy-disk me-2"></i> Simpan Data Kartu</button>
              <p id="nfc-message" class="text-center mt-3 fw-bold"></p>
            </div>

            <div class="card control-card p-4">
              <h5 class="card-title mb-3"><i class="fa-solid fa-list-ul me-2 text-warning"></i> Daftar Kartu Akses Terdaftar</h5>
              <div id="nfc-list-container" class="list-group">
                <p class="text-center text-muted">Memuat daftar kartu...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-warning text-white">
            <h5 class="modal-title" id="changePasswordModalLabel">Ganti Password Akun Admin</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p class="text-muted">Masukkan kredensial lama dan password baru Anda untuk memperbarui data di database.</p>
            <div class="mb-3">
              <label for="modalUsername" class="form-label">Username (UID)</label>
              <input type="text" class="form-control" id="modalUsername" placeholder="Username, misal: yohannes_ta" />
            </div>
            <div class="mb-3">
              <label for="modalCurrentPassword" class="form-label">Password Lama</label>
              <input type="password" class="form-control" id="modalCurrentPassword" placeholder="Password Lama" />
            </div>
            <div class="mb-3">
              <label for="modalNewPassword" class="form-label">Password Baru</label>
              <input type="password" class="form-control" id="modalNewPassword" placeholder="Password Baru (min 6 karakter)" />
            </div>
            <p id="modal-password-message" class="text-danger"></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
            <button type="button" class="btn btn-success" onclick="executePasswordChange()">Konfirmasi Ganti Password</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script src="script.js"></script>
  </body>
</html>
